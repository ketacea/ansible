- name: Check if the path for Python 2 exists
  stat:
    path: /usr/bin/python2
  register: python2_check

- name: Ensure that Python 2 is installed
  fail: msg="Python 2 is not installed"
  when: not python2_check.stat.exists

- name: Check if the path for Supervisor exists
  stat:
    path: "{{ supervisor_bin_path }}/supervisord"
  register: supervisor_check

- name: Unarchive for installing supervisor
  unarchive:
    src: "{{item}}.tar.gz"
    dest: /tmp
  loop: "{{ supervisor_install_dependencies }}"
  when: not supervisor_check.stat.exists

- name: Install supervisor
  shell:
    cd /tmp/{{item}} && /usr/bin/python2 setup.py install --user
  loop: "{{ supervisor_install_dependencies }}"
  when: not supervisor_check.stat.exists